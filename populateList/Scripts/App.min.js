"use strict";function dataManager(n){return{getLists:function(){return n.when(spyreqs.rest.getHostLists("$select=Title,Description,Id"))},getListFields:function(){return n.when(spyreqs.rest.getHostListFields(publicData.selectedListName,""))},getListFieldsForLookups:function(){return n.when(spyreqs.jsom.getHostListFields(publicData.selectedListName))},findGroupsLike:function(t){function s(){for(var n=f.getEnumerator(),t;n.moveNext();)t=n.get_current(),e.push(t.get_title());o=e.filter(c);r.resolve(o)}function h(n,t){say("Get findGroupsLike Failed.   --- "+t.get_message()+"\n"+t.get_stackTrace());r.reject(t)}function c(n){var i=function(t){return n.toLowerCase().indexOf(t.toLowerCase())>-1?!0:!1};return t.some(i)?!0:!1}t=t||["Visitors","Members","Owners"];typeof t=="string"&&(t=[t]);var i=spyreqs.jsom.getTestHostContext(),u=i.appContextSite.get_web(),f=u.get_siteGroups(),e=[],o=[],r=n.defer();return i.context.load(u),i.context.load(f),i.context.executeQueryAsync(s,h),r.promise},getPromiseUserIdsFromGroups:function(t){function c(){$.each(f,function(n,t){for(var i=t.getEnumerator(),r;i.moveNext();)r=i.get_current(),e.addUnique(r.get_id())});say("userIDs: ");say(e);r.resolve(e)}function l(n,t){say("Get getPromiseUserIdsFromGroups Failed.   --- "+t.get_message()+"\n"+t.get_stackTrace());r.reject(t)}say("groups to read: ");say(t);var i=spyreqs.jsom.getTestHostContext(),o=i.appContextSite.get_web(),s=o.get_siteGroups(),u=[],f=[],h=t,e=[],r=n.defer();return h.length>0?(i.context.load(o),i.context.load(s),$.each(h,function(n,t){u.push(s.getByName(t));i.context.load(u[n]);f.push(u[n].get_users());i.context.load(f[n])}),i.context.executeQueryAsync(c,l)):(say("getPromiseUserIdsFromGroups says: no groups in the given array"),setTimeout(r.resolve,0)),r.promise}}}function utils(){return{ruleOut:function(n,t){var i=function(n){var i,r;for(i in t)if(r=n[i],r&&t[i].indexOf(r)>-1)return!1;return!0};return n.filter(i)},showModal:function(){$("#modal").show()},hideModal:function(){$("#modal").hide()},sayFail:function(n){var t,i;say("Error: ");say(n);t="Sorry, an error occured. "+n.args.get_message();log(t);i=notify(t,!1)},showTestBurnBtn:function(){$("#testBurnBtn").show();$("#burnBtn").hide()},showBurnBtn:function(){$("#testBurnBtn").hide();$("#burnBtn").show()},hideUpdateBtns:function(){$("#getFieldsBtn").hide();$("#autoSelectBtn").hide();$("#visitListHref").hide()},showUpdateBtns:function(){$("#getFieldsBtn").show();$("#visitListHref").show()},showUpdatePromisesReadyBtns:function(){$("#autoSelectBtn").show()}}}function appCtrl(n,t,i,r){t.hideModal();var s=function(t){say("assuming data entry methods");var i=n[t],r=function(t){var r=t.FieldTypeKind,i=n.autoFillOptions.filter(function(n){return n.defaultFor==r?!0:!1});return i.length>0&&(t.suggestedSettingItem=i[0]),t};n[t]=i.map(r);n.assumeDone=!0},h=function(t){n.assumeDone||s(t);say("auto select called");var i=function(t){t.suggestedSettingItem&&(t.selectAutoFillData=t.suggestedSettingItem,n.getSelectedDataEntryMethod(t));t.Required===!0&&(t.ngSelected=!0)};n[t].map(i)},c=function(u){var e=notify("Loading lookup fields information...",!1),s=n[u],f=[],o=function(){log("found "+f.length+" lookup Fields, loading all possible values");var n=function(n){var i,u;log("getting values for "+n.lookupField+" of list "+n.lookupList);i="web/lists(guid'"+n.lookupList.slice(1,-1)+"')/Items?$select=ID,"+n.lookupField;publicData.lookupsInfo[n.fieldTitle]=[];u=function(i){var r={title:i[n.lookupField],id:i.ID};publicData.lookupsInfo[n.fieldTitle].push(r);publicData.tempTitlesString+=r.title+", ";t.showUpdatePromisesReadyBtns()};r.when(spyreqs.rest.executeHostCommand(i)).then(function(t){publicData.tempTitlesString="";var i=t.d.results;i.map(u);log("Values for "+n.fieldTitle+": "+publicData.tempTitlesString)},t.sayFail)};f.map(n);SP.UI.Notify.removeNotification(e)};i.getListFieldsForLookups().then(function(n){for(var r=n.getEnumerator(),u=!1;r.moveNext();){var i=r.get_current(),e=i.get_title(),h=i.get_typeAsString(),s=i.get_fieldTypeKind();s==7&&(i.get_readOnlyField()||i.get_hidden()||(u=!0,f.push({fieldTitle:e,lookupField:i.get_lookupField(),lookupList:i.get_lookupList()})))}u?o():t.showUpdatePromisesReadyBtns()},t.sayFail)},e=function(row){var groupsToFindArray=eval(row.dataEntryText),defer=r.defer(),gotIds=function(n){row.selectAutoFillData.fnName="getRandomChoice";row.hiddenFnParams="["+n.toString()+"]";defer.resolve()};return r.when(i.findGroupsLike(groupsToFindArray)).then(i.getPromiseUserIdsFromGroups).then(gotIds,say).catch(function(n){say("error preparing random person");say(n);defer.reject()}),defer.promise},f=function(n){var t=function(n){return n.ngSelected===!0};return n.filter(t)},l=function(n){var t=function(n){return n.ngSelected!==!0};return n.filter(t)},o=function(t){var i={},r=f(n[t]),u=function(n){return{fieldTitle:n.InternalName,fnName:n.selectAutoFillData.fnName,fnParams:n.hiddenFnParams||n.dataEntryText}},e=function(n){n.fnName.length<1&&(n.fnName="copy",n.fnParams="'"+n.fnParams+"'");var t=n.fnName+"("+n.fnParams+")";i[n.fieldTitle]=t},o=r.map(u);return o.map(e),say("item definition"),say(i),i},a=function(n){return n.FieldTypeKind===7?!0:!1},u=function(n){return n.FieldTypeKind===20?!0:!1};n.updateTable=function(r){log("updating table for "+publicData.selectedListName+" list");n.assumeDone=!1;n.ngAllSelected=!1;t.hideUpdateBtns();publicData.working=notify("",!0);var u=notify("Please wait while loading list fields",!1);i.getListFields().then(function(i){n[r]=t.ruleOut(i.d.results,p.unwantedFieldsFilter);SP.UI.Notify.removeNotification(u);n[r].some(a)?c(r):t.showUpdatePromisesReadyBtns();$(".myDataTable").show();t.showUpdateBtns();SP.UI.Notify.removeNotification(publicData.working)},t.sayFail);prepListURL()};n.autoSelect=function(n){h(n)};n.deleteSelected=function(t){var i=n[t];i&&(n[t]=l(n[t]))};n.burn=function(t){function h(){publicData.working=notify("",!0);publicData.burnWaitNotify=notify("Please wait while adding records",!1);publicData.burnAmmount=n.burnAmmount;updateBurnIndicator(0);$("#burnBtn").hide();$(".burnProgressLabel").show();var i=o(t);say("itemDefinition: ");say(i);window.populateList.settings.itemDefinition=i;window.populateList.settings.burnTimes=n.burnAmmount;window.populateList.settings.listName=publicData.selectedListName;window.populateList.startBurn()}var i=f(n[t]),s;i.some(u)?(say("preparing person ids"),s=i.filter(u),r.all(s.map(e)).then(h)):h()};n.testBurn=function(t){function h(){publicData.working=notify("",!0);publicData.testBurnWaitNotify=notify("Please wait while adding one test record",!1);log("Starting test burn");$("#testBurnBtn").hide();var n=o(t);say("itemDefinition: ");say(n);window.populateList.settings.itemDefinition=n;window.populateList.settings.burnTimes=1;window.populateList.settings.listName=publicData.selectedListName;window.populateList.startBurn()}var i=f(n[t]),s;i.some(u)?(say("preparing person ids"),s=i.filter(u),r.all(s.map(e)).then(h)):h()};n.getSelectedList=function(n){publicData.selectedListName=n};n.getSelectedDataEntryMethod=function(n){var r,u,i;t.showTestBurnBtn();r=n.selectAutoFillData;n.label=r.label;n.dataEntryText=r.text;n.label==""?$(".configLabel"+n.Id).hide():$(".configLabel"+n.Id).show();n.dataEntryText==""?$(".configText"+n.Id).hide():$(".configText"+n.Id).show();publicData.lookupsInfo[n.Title]&&r.title=="Lookup"?(u=publicData.lookupsInfo[n.Title],i="["+u.map(function(n){return"'"+n.id+";#"+n.title+"'"}).join(", ")+"]",n.label="One of: "+i,n.dataEntryText=i,$(".configText"+n.Id).hide()):r.title=="Choice of built-in choices"&&n.Choices&&(i="["+n.Choices.results.map(function(n){return"'"+n+"'"}).join(", ")+"]",n.label="One of: "+i,n.dataEntryText=i,$(".configText"+n.Id).hide())};n.checkAll=function(t){angular.forEach(n[t],function(t){t.ngSelected=n.ngAllSelected})};var v=function(r){say("select init called for "+r);i.getLists().then(function(t){n[r]=t.d.results},t.sayFail)},y=function(){say("main controller init called");n.data_ListFieldsArr=[];n.burnAmmount=50},p={unwantedFieldsFilter:{ReadOnlyField:[!0],TypeDisplayName:["Computed"],InternalName:["MetaInfo","Order","Attachments","FileLeafRef"]}};n.autoFillOptions=[{title:"Static text",label:"Standard text to burn",text:"some static text",fnName:"",defaultFor:-1},{title:"Word of n letters",label:"Letters ammount",text:"3",fnName:"getDummyString",defaultFor:2},{title:"Text of n words",label:"Words ammount",text:"3",fnName:"getDummyText",defaultFor:3},{title:"Number of n digits",label:"Digits ammount",text:"3",fnName:"getDummyNumber",defaultFor:10},{title:"Number in range",label:"Sample: [2, 12]",text:"[2, 12]",fnName:"getRandomInt",defaultFor:9},{title:"Choice of n custom choices",label:"Sample: ['single', 'married', 'complicated']",text:"['single', 'married', 'complicated']",fnName:"getRandomChoice",defaultFor:-1},{title:"Choice of built-in choices",label:"[]",text:"",fnName:"getRandomChoice",defaultFor:6},{title:"Person",label:"Possible values: ['owners', 'members', 'visitors']",text:"['members']",fnName:"getRandomPerson",defaultFor:20},{title:"True/False",label:"",text:"",fnName:"getRandomTF",defaultFor:8},{title:"Lookup",label:"[]",text:"",fnName:"getRandomChoice",defaultFor:7},{title:"Date/Time",label:"['from', 'to'] Syntax: y/m/d",text:"['1999/12/30', '2020/12/30']",fnName:"getRandomDate",defaultFor:4},{title:"Guid-like string",label:"",text:"",fnName:"getGuidLike",defaultFor:14},{title:"Hex of n letters",label:"Letters ammount",text:"14",fnName:"getDummyHex",defaultFor:-1}];y();v("data_Lists");Array.prototype.addUnique=function(n){return this.indexOf(n)!==-1?!1:(this.push(n),!0)}}function prepListURL(){return}var say=say||function(n){console.log(n)},startMyTimer=startMyTimer||spyreqs.utils.startMyTimer,getMyTimer=getMyTimer||spyreqs.utils.getMyTimer,publicData={selectedListName:"",burnAmmount:0,lookupsInfo:{},personsInfo:{},working:""},app_version="1.0.1.7",log=function(n){$("#logger").html($("#logger").html()+n+"<br/>")},notify,ngApp,updateBurnIndicator;log("Populate a List, version "+app_version);notify=function(n,t,i){return t?SP.UI.Notify.showLoadingNotification(n):SP.UI.Notify.addNotification(n,i)};ngApp=angular.module("ngApp",[]).controller("appCtrl",appCtrl).factory("utils",utils).factory("dataManager",dataManager);$(".myDataTable").hide();$("#autoSelectBtn").hide();$("#visitListHref").hide();$("#burnProgressLabel").hide();$("#closeModalBtn").click(function(){utils().hideModal()});$("#clearModalBtn").click(function(){$("#logger").html("ready")});$("#showModalBtn").click(function(){utils().showModal()});updateBurnIndicator=function(n){$("#burnProgressLabel").text(n+"/"+publicData.burnAmmount)};
/*
//# sourceMappingURL=App.min.js.map
*/